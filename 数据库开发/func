
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
CREATE FUNCTION getstationname( i_branch CHAR(4) )
	RETURNS CHAR(8)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN SELECT trim(value(name,''))
  FROM HN_BRANCH where station=i_branch;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION getdec_date( i_date decimal(8,0))
	RETURNS char(20)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
DECLARE yea int;
DECLARE mon  int;
DECLARE d  int;
--DECLARE outdate  date;
set yea=int(i_date/10000);
set mon=int(i_date/100)-int(i_date/10000)*100;
set d=i_date-int(i_date/100)*100;
--set outdate=char(yea)||'-'||char(mon)||'-'||char(d);
	RETURN trim(char(yea))||'-'||trim(char(mon))||'-'||trim(char(d));
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
CREATE FUNCTION getzcntname( i_zcnt CHAR(5) )
	RETURNS CHAR(20)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN select trim(value(longdesc,'')) 
	from hn_zcntinfo where fgcommtabl=i_zcnt and validflag='1';
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
CREATE FUNCTION getbranchname( i_branch CHAR(2) )
	RETURNS CHAR(8)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN SELECT trim(value(name,''))
  FROM HN_BRANCH where branch=i_branch;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION getaracdename( i_aracde CHAR(3) )
	RETURNS CHAR(20)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN SELECT trim(value(shortname,''))
  FROM HN_aracde where aracde=i_aracde;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
create function f.get_gx_cnttype(dateStart decimal(8,0),dateEnd decimal(8,0) )
        returns table(
                station varchar(4),
                kinds varchar(3),
                js decimal(10,0),
                bf decimal(20,0)
        )
        return
with
first(chdrnum) as
(select chdrnum from administrator.hn_chdrinfo
        where statcode in('MA','IF')
        and cnttype in (select crtable from administrator.bj_cnttype_fl where ywxl='IND')),
second(station,bm_cert,kinds,bf,flag) as
(select a.branch,a.chdrnum,a.cnttype,sum(a.acctamt),'1'
        from administrator.hn_acctinfo a
                where exists(select chdrnum from first b where a.chdrnum=b.chdrnum)
                and a.trandate between dateStart and dateEnd
                        group by a.branch,a.chdrnum,a.cnttype),
third(station,bm_cert,kinds,bf,flag) as
(select a.agntbr,a.chdrnum,a.cnttype,sum(a.acctamt),'2'
        from administrator.hn_xuqiacct a
                where exists(select chdrnum from first b where a.chdrnum=b.chdrnum)
                and a.occdate between dateStart and dateEnd
                        group by a.agntbr,a.chdrnum,a.cnttype),
fourth(station,bm_cert,kinds,bf,flag) as
(select * from second union all select * from third)

select station,kinds,count(distinct bm_cert),sum(bf)
        from fourth
                group by station,kinds
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION GETXYNAME( vfgcommtabl CHAR(5) )
	RETURNS VARCHAR(8)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN select shortdesc from administrator.HN_ZCNTINFO where fgcommtabl=vfgcommtabl and validflag='1';
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION getbfdate( i_date decimal(8,0),i_bfm decimal(2,0),i_day decimal(2,0)  )
	RETURNS decimal(8,0)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
DECLARE yea decimal(4,0);
DECLARE mon  decimal(2,0);
DECLARE d  decimal(2,0);
DECLARE bfy  decimal(2,0);
DECLARE bfm  decimal(2,0);
set yea=int(i_date/10000);
set mon=int(i_date/100)-int(i_date/10000)*100;
set bfy=int(i_bfm/12);
set bfm=i_bfm-bfy*12;
if i_day >31 then
set d=i_date-int(i_date/100)*100;
else
set d=i_day;
end if;
if mon>bfm then
	RETURN (yea-bfy)*10000+(mon-bfm)*100+d;
	else 
	RETURN (yea-bfy-1)*10000+(mon-bfm+12)*100+d;
end if;

END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION getjdcdate( i_date decimal(8,0))
	RETURNS decimal(8,0)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
DECLARE yea decimal(4,0);
DECLARE mon  decimal(2,0);
DECLARE d  decimal(2,0);
DECLARE jd  decimal(2,0);
set yea=int(i_date/10000);
set mon=int(i_date/100)-int(i_date/10000)*100;
set d=i_date-int(i_date/100)*100;
set jd=int((mon-1)/3);
	RETURN yea*10000+(jd*3+1)*100+1;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION getaratobr( i_aracde CHAR(3) )
	RETURNS CHAR(2)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN SELECT trim(value(branch1,''))
  FROM administrator.hn_aracde where aracde=i_aracde;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.datefomat(indate varchar(20))
        RETURNS varchar(20)
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        declare indate1 varchar(20);
        set indate1 = substr(indate,1,8);
        RETURN left(indate1,4) || '-' || right(left(indate1,6),2) || '-' || right(indate1,2);
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION administrator.get_branch_dqrl_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(distinct agntnum)rl from administrator.hn_agntinfo
        where DTETRM = 99999999
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION administrator.get_aracde_bf_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                aracde char(3),
                cityflag varchar(3),
                xqflag varchar(3),
                agentflag varchar(3),
                bb decimal(20,2)
        )

        SPECIFIC get_aracde_bf_gx

        RETURN
        select a.branch,a.aracde,a.cityflag,a.xqflag,a.agentflag,b.bf from administrator.hn_aracde a left join
        (select branch,aracde,sum(acctamt_std)bf from administrator.hn_acctinfo
        where trandate between (year_mon *100+1) and (year_mon *100+31) and batctrcde<>'TGJC'
        and agtype in('RC')
        group by branch,aracde) b on b.aracde=a.aracde where a.branch <> 'D'

@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION administrator.get_branch_rl_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(distinct agntnum)rl from administrator.hn_agntinfo
        where dteapp <=(year_mon*100+31) and DTETRM >=(year_mon*100+1)
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch

@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION administrator.get_branch_hd_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(agntnum) hd from
        (select distinct branch,agntnum from administrator.hn_acctinfo
        where trandate between (year_mon*100+1) and (year_mon*100+31) and batctrcde<>'TGJC'
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch,agntnum having sum(acctamt_std)>0) a group by branch
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION administrator.get_branch_qp_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(agntnum) hd from
        (select distinct branch,agntnum from administrator.hn_acctinfo
        where trandate between (year_mon*100+1) and (year_mon*100+31) and batctrcde<>'TGJC'
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch,agntnum having sum(acctamt_std)>=1000) a group by branch
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
CREATE FUNCTION administrator.get_branch_3qp_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(agntnum) hd from
        (select distinct branch,agntnum from administrator.hn_acctinfo
        where trandate between (year_mon*100+1) and (year_mon*100+31) and batctrcde<>'TGJC'
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch,agntnum having sum(acctamt_std)>=3000) a group by branch
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
CREATE FUNCTION administrator.get_branch_5qp_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(agntnum) hd from
        (select distinct branch,agntnum from administrator.hn_acctinfo
        where trandate between (year_mon*100+1) and (year_mon*100+31) and batctrcde<>'TGJC'
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch,agntnum having sum(acctamt_std)>=5000) a group by branch
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
CREATE FUNCTION administrator.get_branch_wp_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(agntnum) hd from
        (select distinct branch,agntnum from administrator.hn_acctinfo
        where trandate between (year_mon*100+1) and (year_mon*100+31) and batctrcde<>'TGJC'
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch,agntnum having sum(acctamt_std)>=10000) a group by branch
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
CREATE FUNCTION administrator.get_branch_js_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                js decimal(20,0)
        )

        RETURN
        select branch,(count(distinct case when batc_type = 'CB' then chdrnum end)-
        count(distinct case when  batc_type = 'CD' then chdrnum end)) js
        from administrator.hn_acctinfo
        where trandate between (year_mon*100+1) and (year_mon*100+31) and batctrcde<>'TGJC'
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION administrator.get_branch_rs_gx(year_mon integer)
        RETURNS TABLE(
                branch char(2),
                rl decimal(20,0)
        )

        RETURN
        select branch,count(distinct agntnum) rl from administrator.hn_agntinfo
        where dteapp between (year_mon*100+1) and (year_mon*100+31)
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch

@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION administrator.get_yb_cl()
        RETURNS TABLE(
                branch char(2),
                kinds varchar(6),
                source varchar(3),
                bf decimal(20,0)
        )

        RETURN
        select value(station,'00'),value(kinds,'-'),value(source,'-'),value(sum(jf_je),0) from
        (select distinct station,bm_contract,jf_je,kinds,agency_code,left(medi_code,2) as source
        from administrator.hn_basdata where app_flag in ('1') and detail_flag = 'YX'
        and agency_code not in(select agency_code from administrator.hn_agency_ybxq))a
        group by station,kinds,source

@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
create  FUNCTION
        administrator.getybkpi (
                sort varchar(3),
                jf_way varchar(5),
                jfyears decimal(3,0),
                gmbf decimal(10,2),
                bzbf decimal(10,2)
                )
        RETURNS decimal(15,2)
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN
        values(case
                when sort = 'SQ' then bzbf
                when sort in('TZ','FIC') and jf_way='0' then gmbf*0.1
                when sort in('TZ','FIC') and jf_way='12' and jfyears<5 then gmbf*0.1*jfyears
                when sort in('TZ','FIC') and jf_way not in('S','0','12') and jfyears>=5 then gmbf
                else bzbf
        end);
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION administrator.getcnttypename( cnttype CHAR(3) )
        RETURNS CHAR(50)
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN SELECT trim(value(longdesc,''))
  FROM administrator.hn_cnttype where descitem=cnttype;
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
CREATE
FUNCTION administrator.stationtobranch( station1 varCHAR(4) )
        RETURNS CHAR(2)
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN SELECT trim(value(branch,''))
                FROM administrator.hn_branch where station=station1;
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
CREATE  FUNCTION
        administrator.getybbb(sort varchar(3),jf_way varchar(3),jfyears smallint,kinds char(3),jf_je decimal(15,2))
        RETURNS decimal(15,2)
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN
        values(case
                when sort = 'SQ' and jf_way='0' and kinds<>'532' then jf_je*0.1
                when sort = 'SQ' and jf_way='0' and kinds='532'  then jf_je*0.02
                when sort = 'SQ' and jf_way='12' and jfyears<=3  and kinds ='523' then jf_je*1.5
                when sort = 'SQ' and jf_way='12' and jfyears=5 and kinds ='523' then jf_je*1.5
                when sort = 'SQ' and jf_way='12' and jfyears>=10 and kinds ='523' then jf_je*2
                when sort = 'SQ' and jf_way='12' and jfyears<=3  and kinds <>'523' then jf_je*0.3
                when sort = 'SQ' and jf_way='12' and jfyears=5 and kinds <>'523' then jf_je*0.5
                when sort = 'TZ' and jf_way='12' and jfyears<10 and kinds ='523' then jf_je*0.1*jfyears
                when sort = 'TZ' and jfyears<5 then jf_je*0.1*jfyears
                when sort = 'FIC' and jfyears=5 and kinds = '523' then jf_je*2
                else jf_je
        end);
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION administrator.date_int(mydate date )
        RETURNS integer
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN
        values(year(mydate)*10000+month(mydate)*100+day(mydate));
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
cREATE  FUNCTION
        administrator.gettz(sort varchar(3),jf_way varchar(3),jfyears smallint,kinds char(3),jf_je decimal(15,2))
        RETURNS decimal(15,2)
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN
        values(case
                when sort = 'TZ' and jf_way='12' and jfyears<5 and kinds ='523' then jf_je*0.1*jfyears
                when sort = 'TZ' and jf_way='0' and jfyears<5 and kinds ='523' then jf_je*0.1*jfyears
                when sort = 'TZ' and jf_way ='S' then jf_je*0.1
                when sort = 'TZ' and jf_way not in('S','0','12') and jfyears<5 then jf_je*0.1*jfyears
                else jf_je
        end);
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION administrator.getbankname( bank char(2) )
        RETURNS VARCHAR(12)
        NO EXTERNAL ACTION

F1: BEGIN ATOMIC
        RETURN
        values(case
                when bank = '01' then ''
                when bank = '02' then ''
                when bank = '03' then ''
                when bank = '04' then ''
                when bank = '05' then ''
                when bank = '06' then ''
                when bank = '09' then ''
                when bank = '10' then ''
                when bank = '11' then ''
                when bank = '14' then ''
                when bank = '16' then ''
                when bank = '17' then ''
                when bank = '18' then ''
                when bank = '28' then ''
                when bank = '15' then ''
                else ''
        end);
END

@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE  FUNCTION f.get_ybsq_gjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from v.ybnew
                                                        where trandate between monStart and monEnd
                                                        and series = 'SQ' and isdgx = 'Y' )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_yb_xq(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                bf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,station,group
                        from administrator.hn_branch
                                where branch <> 'D'),
                ybbf as
                (select station,sum(jf_je)ybbf 
                        from administrator.hn_basdata 
                                where year(jf_rq)*10000+month(jf_rq)*100+day(jf_rq) between monStart and monEnd 
                                and app_flag in ('2') and medi_code not like '%WY%' 
                                        group by station),
                gxbf as
                (select agntbr,sum(acctamt)gxbf
                        from administrator.hn_xuqiacct
                                where trandate between monStart and monEnd and agtype in('BA','BY','BZ','BC','BD','BM','BP')
                                        group by agntbr )
                select a.branch,a.name,b.ybbf as bf,a.group from branch a left join ybbf b 
                        on a.station = b.station
                union all
                select a.branch,a.name,b.gxbf as bf,a.group from branch a left join gxbf b
                        on a.branch = b.agntbr@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.get_yx_jz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum from administrator.hn_acctinfo  
                                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  
                                                and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS')) 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION GetStName( station10 VARCHAR(10) )
	RETURNS VARCHAR(8)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN select case st_station when '0801' then '' when '0811' then '' when '0812' then ''
when '0813' then '' when '0814' then '' when '0815' then '' when '0816' then ''
when '0817' then '' when '0818' then ''  when '0819' then '' when '0820' then ''
when '0821' then '' when '0822' then '' when '0823' then '' when '0824' then ''
when '0825' then '' when '0826' then '' end
from administrator.station
where st_station<>'08' and st_station=station10;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
CREATE FUNCTION get_insure_name( insure VARCHAR(10) )
	RETURNS VARCHAR(10)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN SELECT trim(NAME)
  FROM administrator.person
  WHERE INSURE_NU =insure_nu;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
create function f.get_ybsq_agent()
        returns table(
                series varchar(3),
                name varchar(15),
                agency_code char(8),
                station char(4),
                state char(1)
        )
        return
                select 'SQ',name,agency_code,station,state from administrator.hn_agency
                        where agency_group not in ('08900069','08900070','08900071','08900074')
                        and agency_code not like '808%'
                        and agency_code not like '%A'
                        and agency_code not like '%WY%'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
create function f.get_ybxq_agent()
        returns table(
                series varchar(3),
                name varchar(15),
                agency_code char(8),
                station char(4),
                state char(1)
        )
        return
                select 'TZ',name,agency_code,station,state from administrator.agency
                        where state in('10','11','19')
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
create function f.get_ybfic_agent()
        returns table(
                series varchar(3),
                name varchar(15),
                agency_code char(8),
                station char(4),
                state char(1)
        )
        return
                select 'FIC',name,agency_code,station,state from administrator.agency
                        where agency_group IN ('08900069','08900070','08900071')
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION GetSuName( insure VARCHAR(10) )
	RETURNS VARCHAR(8)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN select name from administrator.person where insure_nu=insure;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION GetClName( insure VARCHAR(8) )
	RETURNS VARCHAR(8)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN select surname from administrator.clntpf where clntnum=insure;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
create function f.get_yb_cnttype(dateStart decimal(8,0),dateEnd decimal(8,0) )
        returns table(
                station varchar(4),
                kinds varchar(3),
                js decimal(10,0),
                bf decimal(20,0)
        )
        return
                with
                first(bm_cert) as
                (select distinct bm_cert from administrator.hn_basdata a
                        where detail_flag in('YX','MQ')
                        and app_flag = '1'
                        and year(jf_rq)*10000+month(jf_rq)*100+day(jf_rq)
                                between dateStart and dateEnd
                        and not exists(select bm_cert from administrator.hn_basmqjf b
                                where a.bm_cert = b.bm_cert )
                        and kinds in(select CRTABLE from administrator.bj_cnttype_fl
                                        where ywxl='BNK')),
                second(station,bm_cert,kinds,jf_rq,jf)as
                (select station,bm_cert,kinds,jf_rq,sum(jf_je) from administrator.hn_basdata a
                        where exists(select * from first b where b.bm_cert=a.bm_cert)
                        and detail_flag in('YX','MQ')
                                group by station,bm_cert,kinds,jf_rq)
                select station,kinds,count(distinct bm_cert),sum(jf)
                        from second
                                group by station,kinds
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
create function f.get_gx_cnttype_jy(dateStart decimal(8,0),dateEnd decimal(8,0))
        returns table(
                station varchar(4),
                kinds varchar(3),
                js decimal(10,0),
                bf decimal(20,0)
        )
        return
                with
                first(station,bm_cert,trandte,kinds,bf,flag) as
                (select a.branch,a.chdrnum,a.trandate,a.cnttype,sum(a.acctamt),'1'
                        from administrator.hn_acctinfo a,administrator.hn_chdrinfo b
                                where a.chdrnum = b.chdrnum and a.aracde = '806'
                                and a.trandate between dateStart and dateEnd
                                and b.statcode in('MA','IF')
                                        group by a.branch,a.chdrnum,a.trandate,a.cnttype),
                second(station,bm_cert,trandte,kinds,bf,flag) as
                (select a.agntbr,a.chdrnum,a.trandate,a.cnttype,sum(a.acctamt),'2'
                        from administrator.hn_xuqiacct a,administrator.hn_chdrinfo b
                                where a.chdrnum = b.chdrnum and a.agntara = '806'
                                and a.occdate between dateStart and dateEnd
                                and b.statcode in('MA','IF')
                                        group by a.agntbr,a.chdrnum,a.trandate,a.cnttype),
                third(station,bm_cert,trandte,kinds,bf,flag) as
                (select * from first union all select * from second)

                select station,kinds,count(distinct bm_cert),sum(bf)
                        from third
                                group by station,kinds
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION FUN_CHTB( chdr CHAR(8) )
	RETURNS DECIMAL(8,2)
	NO EXTERNAL ACTION
------------------------------------------------------------------------
-- SQL UDF (Scalar)
------------------------------------------------------------------------
F1: BEGIN ATOMIC
	RETURN select coalesce(sum(acctamt),0)
from administrator.m_acmvpf
where batctrcde='T512'
and sacscode <>'LP'
and sacstyp <> 'PS'
and effdate >= 20130801
and chdrnum=chdr;
END@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
create  function f.getbranchname(i_branch varchar(4))
        returns varchar(9)
        NO EXTERNAL ACTION
        begin atomic
        if length(i_branch) = 4 then
                return
                        select trim(value(name,''))
                                from administrator.hn_branch where station = i_branch;
        else
                return
                        select trim(value(name,''))
                                from administrator.hn_branch where branch = i_branch;
        end if;
        end
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION administrator.getstate( state char(2) )
        RETURNS VARCHAR(12)
        NO EXTERNAL ACTION

F1: BEGIN ATOMIC
        RETURN
        values(case
                when state = 'CF' then ''
                when state = 'IF' then ''
                when state = 'MU' then ''
                when state = 'PT' then ''
                when state = 'SO' then ''
                when state = 'PS' then ''
                when state = 'DC' then ''
                when state = 'LA' then ''
                when state = 'PC' then ''
                when state = 'PU' then ''
                when state = 'SD' then ''
                when state = 'DH' then ''
                when state = 'MA' then ''
                when state = 'PO' then ''
                when state = 'RD' then ''
                when state = 'WD' then ''
                when state = 'EX' then ''
                when state = 'MR' then ''
                when state = 'SU' then ''
                when state = 'YX' then ''
                when state = 'ZT' then ''
        end);
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_yb_zgm2wprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys
                                group by branch,agntnum
                                        having sum(acctamt) >=20000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_yb_zgm3wprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys
                                group by branch,agntnum
                                        having sum(acctamt) >=30000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_yb_zgm5wprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys
                                group by branch,agntnum
                                        having sum(acctamt) >=50000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE  FUNCTION f.get_ybsq_rl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                rl decimal(6,0)
        )
        RETURN
                with mytable(station,agency_code,name,rq_start,rq_end,state)as
                        (select station,agency_code,name,year(rq_start)*10000+month(rq_start)*100+day(rq_start),
                        year(rq_end)*10000+month(rq_end)*100+day(rq_end),state
                                from administrator.agency
                                        where state ='0' or (rq_end is not null and state = '1')),
                     agency_count(branch,sum_agency )as
                        (select station,count(agency_code) from mytable
                                where (rq_start <= dateend and rq_end > dateend and state='1')
                                or state in('0')
                                        group by station)
                     select a.branch,b.sum_agency from administrator.hn_branch a left join agency_count b
                        on a.station = b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_ybsq_gmplrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gmplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.get_yb_zgmplrl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys
                                group by branch,agntnum
                                        having sum(acctamt) >0)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.get_yb_qjplrl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys and freq = 'Q'
                                group by branch,agntnum
                                        having sum(acctamt) >0)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
CREATE FUNCTION f.get_yb_qjwprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys and freq = 'Q'
                                group by branch,agntnum
                                        having sum(acctamt) >=10000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_yb_qj2wprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys and freq = 'Q'
                                group by branch,agntnum
                                        having sum(acctamt) >=20000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_yb_qj3wprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys and freq = 'Q'
                                group by branch,agntnum
                                        having sum(acctamt) >=30000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_yb_qj5wprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys and freq = 'Q'
                                group by branch,agntnum
                                        having sum(acctamt) >=50000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_yb_zgmrl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3),rule decimal(6,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                rl decimal(6,0),
                bf decimal(15,0),
                js decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,chdrnum,bf) as(
                select branch,agntnum,chdrnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys
                                group by branch,agntnum,chdrnum
                                        having sum(acctamt) >= rule)
                select a.branch,a.name,count(distinct agntnum),sum(bf),count(distinct chdrnum),a.group 
                        from administrator.hn_branch a left join mytable b
                                on a.branch = b.branch where a.branch <> 'D'
                                        group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION f.get_yb_qjrl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3),rule decimal(6,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                rl decimal(6,0),
                bf decimal(15,0),
                js decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,chdrnum,bf) as(
                select branch,agntnum,chdrnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys and freq = 'Q'
                                group by branch,agntnum,chdrnum
                                        having sum(acctamt) >= rule)
                select a.branch,a.name,count(distinct agntnum),sum(bf),count(distinct chdrnum),a.group 
                        from administrator.hn_branch a left join mytable b
                                on a.branch = b.branch where a.branch <> 'D'
                                        group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
CREATE FUNCTION f.get_yb_cnt(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3),rule decimal(6,0),cnt varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                rl decimal(6,0),
                bf decimal(15,0),
                js decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,chdrnum,bf) as(
                select branch,agntnum,chdrnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys and cnttype = cnt
                                group by branch,agntnum,chdrnum
                                        having sum(acctamt) >= rule)
                select a.branch,a.name,count(distinct agntnum),sum(bf),count(distinct chdrnum),a.group 
                        from administrator.hn_branch a left join mytable b
                                on a.branch = b.branch where a.branch <> 'D'
                                        group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
CREATE FUNCTION f.get_ybsq_523plrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION f.get_ybsq_523wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfwprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
CREATE FUNCTION f.get_ybsq_5232wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf2wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybsq_5233wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf3wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybsq_5235wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf5wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybsq_AB8(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8bf decimal(20,0),
                ab8js decimal(10,0)
        )
        RETURN
	with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when statcode = '1' then 1
                when statcode = 'WT' then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and cnttype = 'AB8'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION f.get_ybsq_ab8plrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8plrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
CREATE FUNCTION f.get_ybsq_ab8wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_ybsq_ab82wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab82wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_ybsq_ab83wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab83wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_ybsq_ab85wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab85wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'SQ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_ybxq_gm(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gmbf decimal(20,0),
                gmjs decimal(10,0)
        )
        RETURN
        with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when statcode = '1' then 1
                when statcode = 'WT' then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and sort = 'y' and series = 'TZ'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE  FUNCTION f.get_ybxq_rl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                rl decimal(6,0)
        )
        RETURN
                with mytable(station,agency_code,name,rq_start,rq_end,state)as
                        (select station,agency_code,name,year(rq_start)*10000+month(rq_start)*100+day(rq_start),
                        year(rq_end)*10000+month(rq_end)*100+day(rq_end),state
                                from administrator.agency
                                        where state in('10','11') or (rq_end is not null and state = '19')),
                     agency_count(branch,sum_agency )as
                        (select station,count(agency_code) from mytable
                                where (rq_start <= dateend and rq_end > dateend and state='19')
                                or state in('10','11')
                                        group by station)
                     select a.branch,b.sum_agency from administrator.hn_branch a left join agency_count b
                        on a.station = b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION f.get_ybxq_gmplrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gmplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.get_ybxq_gmwprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gmwprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION f.get_ybxq_gm2wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gm2wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_ybxq_gm3wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gm3wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_ybxq_gm5wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gm5wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_ybxq_qj(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qjbf decimal(20,0),
                qjjs decimal(10,0)
        )
        RETURN
        with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when acctamt >= 0 then 1
                when acctamt < 0 then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq <> '0'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybxq_qjplrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qjplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
CREATE FUNCTION f.get_ybxq_qjwprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qjwprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE  FUNCTION f.get_ybxq_qj2wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qj2wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.get_ybxq_qj3wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qj3wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_ybxq_qj5wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qj5wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_ybxq_523(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfbf decimal(20,0),
                xfjs decimal(10,0)
        )
        RETURN
	with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when statcode = '1' then 1
                when statcode = 'WT' then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and sort = 'y' and series = 'TZ' and freq = '12' and cnttype = '523'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybxq_523plrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION f.get_ybxq_523wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfwprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
CREATE FUNCTION f.get_ybxq_5232wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf2wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybxq_5233wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf3wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybxq_5235wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf5wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybxq_AB8(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8bf decimal(20,0),
                ab8js decimal(10,0)
        )
        RETURN
	with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when statcode = '1' then 1
                when statcode = 'WT' then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and cnttype = 'AB8'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION f.get_ybxq_ab8plrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8plrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
CREATE FUNCTION f.get_ybxq_ab8wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_ybxq_ab82wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab82wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_ybxq_ab83wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab83wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_ybxq_ab85wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab85wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'TZ' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_ybfic_gm(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gmbf decimal(20,0),
                gmjs decimal(10,0)
        )
        RETURN
        with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when statcode = '1' then 1
                when statcode = 'WT' then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and sort = 'y' and series = 'FIC'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
CREATE FUNCTION f.get_ybfic_rl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                rl decimal(6,0)
        )
        RETURN
                with mytable(branch,rl)as
                (select branch,count(agntnum)
                        from administrator.hn_agntinfo
                                where dteapp <=dateend
                                and dtetrm >= datestart
                                and agtype in('BC','BD','BM','BP')
                                        group by branch)
                select a.branch,value(b.rl,0) from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
CREATE FUNCTION f.get_ybfic_gmplrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gmplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
CREATE FUNCTION f.get_ybfic_gmwprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gmwprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_ybfic_gm2wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gm2wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybfic_gm3wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gm3wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybfic_gm5wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                gm5wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybfic_qj(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qjbf decimal(20,0),
                qjjs decimal(10,0)
        )
        RETURN
        with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when acctamt >=0 then 1
                else -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq <> '0'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybfic_qjplrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qjplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
CREATE FUNCTION f.get_ybfic_qjwprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qjwprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE  FUNCTION f.get_ybfic_qj2wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qj2wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
CREATE FUNCTION f.get_ybfic_qj3wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qj3wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybfic_qj5wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                qj5wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq <> '0'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybfic_523(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfbf decimal(20,0),
                xfjs decimal(10,0)
        )
        RETURN
	with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when statcode = '1' then 1
                when statcode = 'WT' then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and sort = 'y' and series = 'FIC' and freq = '12' and cnttype = '523'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_ybfic_523plrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfplrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_ybfic_523wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xfwprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybfic_5232wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf2wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_ybfic_5233wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf3wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_ybfic_5235wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                xf5wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and freq = '12' and cnttype = '523'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_ybfic_AB8(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8bf decimal(20,0),
                ab8js decimal(10,0)
        )
        RETURN
	with mytable(branch,bf,js) as
        (select branch,sum(acctamt) bf,sum(case when statcode = '1' then 1
                when statcode = 'WT' then -1 end) from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and cnttype = 'AB8'
                                group by branch)
        select a.branch,value(b.bf,0),value(b.js,0)
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
CREATE FUNCTION f.get_ybfic_ab8plrl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8plrl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >0)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.get_ybsq_zjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = 'SQ') 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybfic_ab8wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab8wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=10000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_ybfic_ab82wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab82wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=20000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION f.get_sz_jz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum from administrator.hn_acctinfo  
                                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  
                                                and agtype in('RC')) 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION f.get_ybfic_ab83wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab83wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=30000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION f.get_ybfic_ab85wprl(datestart decimal(8,0),dateend decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                ab85wprl decimal(6,0)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std))
                from hnii29.hn_ybyj
                        where trandate between datestart and dateend
                        and series = 'FIC' and cnttype = 'AB8'
                                group by branch,agntnum
                                        having sum(administrator.getybkpi(series,freq,period,acctamt,acctamt_std)) >=50000)
                select a.branch,count(agntnum) from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch
                                where a.branch <> 'D'
                                        group by a.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION f.get_ybsq_qjjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = 'SQ'
                                                        and ((FREQ = '12' and sort = 'y') or (sort = 'g' and freq <> 'S')) )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE  FUNCTION f.get_ybfic_gjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from v.ybnew
                                                        where trandate between monStart and monEnd
                                                        and series = 'FIC' and isdgx = 'Y' )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_ybtz_zjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = 'TZ') 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_ybtz_qjjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = 'TZ'
                                                        and ((FREQ = '12' and sort = 'y') or (sort = 'g' and freq <> 'S')) )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE  FUNCTION f.get_ybtz_gjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from v.ybnew
                                                        where trandate between monStart and monEnd
                                                        and series = 'TZ' and isdgx = 'Y' )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
CREATE FUNCTION f.get_ybfic_zjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = 'FIC') 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_ybfic_qjjz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = 'FIC'
                                                        and ((FREQ = '12' and sort = 'y') or (sort = 'g' and freq <> 'S')) )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
CREATE  FUNCTION f.get_ybsq_zgm(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                gmbf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(acctamt) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = 'SQ'
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_dx_jz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum from administrator.hn_acctinfo  
                                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  
                                                and agtype in('TR','TB')) 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
CREATE FUNCTION f.get_yj_jz(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum from administrator.hn_acctinfo  
                                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  
                                                and agtype in('HA')) 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION f.get_gx_hd_aracde(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                aracde char(3),
                rl decimal(20,0)
        )

        RETURN
        select branch,aracde,count(agntnum) hd from
        (select distinct branch,aracde,agntnum from administrator.hn_acctinfo
        where trandate between monStart and monEnd and batctrcde<>'TGJC'
        and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
        group by branch,aracde,agntnum having sum(acctamt_std)>0) a group by branch,aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE  FUNCTION f.get_bf_anal_gx(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                aracde char(3),
                bf0_2999 decimal(15,2),
                js0_2999 decimal(6,0),
                bf3000_3999 decimal(15,2),
                js3000_3999 decimal(6,0),
                bf4000_4999 decimal(15,2),
                js4000_4999 decimal(6,0),
                bf5000_9999 decimal(15,2),
                js5000_9999 decimal(6,0),
                bf10000_19999 decimal(15,2),
                js10000_19999 decimal(6,0),
                bf20000 decimal(15,2),
                js20000 decimal(6,0),
                zbf decimal(15,2),
                zjs decimal(7,0)              
        )
        RETURN
                with chdrinfo as(
                select branch,aracde,chdrnum,sum(acctamt_std) as bf 
                        from administrator.hn_acctinfo  
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  
                                and agtype in ('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
                                        group by branch,aracde,chdrnum
                                                having sum(acctamt_std) >0),
                branchList as(
                select branch,aracde 
                        from administrator.hn_aracde 
                               where agentflag = 'N')
                select a.branch,a.aracde,
                sum(case when b.bf <3000 then bf end),count(case when b.bf <3000 then chdrnum end),
                sum(case when b.bf between 3000 and 3999.99 then bf end),count(case when b.bf between 3000 and 3999.99 then chdrnum end),
                sum(case when b.bf between 4000 and 4999.99 then bf end),count(case when b.bf between 4000 and 4999.99 then chdrnum end),
                sum(case when b.bf between 5000 and 9999.99 then bf end),count(case when b.bf between 5000 and 9999.99 then chdrnum end),
                sum(case when b.bf between 10000 and 19999.99 then bf end),count(case when b.bf between 10000 and 19999.99 then chdrnum end),
                sum(case when b.bf >=20000 then bf end),count(case when b.bf >=20000 then chdrnum end),
                sum(bf),count(chdrnum)
                        from branchList a left join chdrinfo b on a.branch=b.branch and a.aracde=b.aracde
                                group by a.branch,a.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
CREATE  FUNCTION f.get_cnttype_anal_gx(monStart decimal(8,0),monEnd decimal(8,0),cnt varchar(5))
        RETURNS TABLE(
                branch char(2),
                aracde char(3),
                bf0_2999 decimal(15,2),
                js0_2999 decimal(6,0),
                bf3000_3999 decimal(15,2),
                js3000_3999 decimal(6,0),
                bf4000_4999 decimal(15,2),
                js4000_4999 decimal(6,0),
                bf5000_9999 decimal(15,2),
                js5000_9999 decimal(6,0),
                bf10000_19999 decimal(15,2),
                js10000_19999 decimal(6,0),
                bf20000 decimal(15,2),
                js20000 decimal(6,0),
                zbf decimal(15,2),
                zjs decimal(7,0)              
        )
        RETURN
                with chdrinfo as(
                select branch,aracde,chdrnum,cnttype,sum(acctamt_std) as bf 
                        from administrator.hn_acctinfo  
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  and cnttype = cnt
                                and agtype in ('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS','RC')
                                        group by branch,aracde,chdrnum,cnttype
                                                having sum(acctamt_std) >0),
                branchList as(
                select branch,aracde 
                        from administrator.hn_aracde 
                               where agentflag = 'N')
                select a.branch,a.aracde,
                sum(case when b.bf <3000 then bf end),count(case when b.bf <3000 then chdrnum end),
                sum(case when b.bf between 3000 and 3999.99 then bf end),count(case when b.bf between 3000 and 3999.99 then chdrnum end),
                sum(case when b.bf between 4000 and 4999.99 then bf end),count(case when b.bf between 4000 and 4999.99 then chdrnum end),
                sum(case when b.bf between 5000 and 9999.99 then bf end),count(case when b.bf between 5000 and 9999.99 then chdrnum end),
                sum(case when b.bf between 10000 and 19999.99 then bf end),count(case when b.bf between 10000 and 19999.99 then chdrnum end),
                sum(case when b.bf >=20000 then bf end),count(case when b.bf >=20000 then chdrnum end),
                sum(bf),count(chdrnum)
                        from branchList a left join chdrinfo b on a.branch=b.branch and a.aracde=b.aracde
                                group by a.branch,a.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
CREATE FUNCTION f.get_yx_bb(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch
                                and agentflag = 'N'),
                yxbb as
                (select branch,aracde,sum(acctamt_std)bb 
                        from administrator.hn_acctinfo
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'
                                and agtype in('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS')
                                        group by branch,aracde)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join yxbb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
CREATE FUNCTION f.get_xq_bb(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch
                                and agentflag = 'N'),
                yxbb as
                (select branch,aracde,sum(acctamt_std)bb 
                        from administrator.hn_acctinfo
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'
                                and agtype in('RC')
                                        group by branch,aracde)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join yxbb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE  FUNCTION f.get_xq_zcqbb(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch
                                and agentflag = 'N'),
                bb as
                (select branch,aracde,sum(acctamt_std)bb 
                        from administrator.hn_acctinfo 
                                where trandate between monStart and monEnd and batctrcde<>'TGJC' 
                                and agtype='RC' and agntnum not like 'YD%' 
                                and aracde in (select aracde from administrator.hn_aracde where (aracde like '%AA' and aracde not like 'IAA') 
                                or aracde in ('002','615','907','415','D07','814','502'))
                                and agntnum not in (select zcllctor from administrator.HN_ZCLLINFO where zcllcls not in ('SZE0','SZE1','SZE2','SZD0','SZD1','SZD2','SZC0','SZC1','SZC2')) 
                                        group by branch,aracde)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join bb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_xq_sfzgm(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch
                                and agentflag = 'N'),
                bb as
                (select agntbr as branch,agntara as aracde,sum(acctamt)bb 
                        from administrator.hn_xuqiacct 
                            where trandate between monStart and monEnd
                            and agtype in('RC','TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS') 
                            group by agntbr,agntara)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join bb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE  FUNCTION f.get_ybsq_qjbf(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                gmbf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(acctamt) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = 'SQ' and freq = 'Q'
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE  FUNCTION f.get_ybsq_dgx(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                bf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(acctamt_std) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = 'SQ' and isdgx='Y'
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE  FUNCTION f.get_ybtz_dgx(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                bf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(acctamt_std) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = 'TZ' and isdgx='Y'
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_yb_dgx(monStart decimal(8,0),monEnd decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                bf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(acctamt_std) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = sys and isdgx='Y'
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
CREATE  FUNCTION f.get_yb_qjbf(monStart decimal(8,0),monEnd decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                gmbf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(acctamt) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = sys and freq = 'Q'
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE  FUNCTION f.get_yb_zgm(monStart decimal(8,0),monEnd decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                gmbf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(acctamt) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = sys
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_dx_bb(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch),
                yxbb as
                (select branch,aracde,sum(acctamt_std)bb 
                        from administrator.hn_acctinfo
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'
                                and agtype in('TR','TB')
                                        group by branch,aracde)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join yxbb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_dx_xq(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch),
                bb as
                (select agntbr as branch,agntara as aracde,sum(acctamt)bb 
                        from administrator.hn_xuqiacct 
                            where trandate between monStart and monEnd
                            and agtype in('TR','TB')
                            group by agntbr,agntara)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join bb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
CREATE FUNCTION f.get_yj_bb(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch),
                yxbb as
                (select branch,aracde,sum(acctamt_std)bb 
                        from administrator.hn_acctinfo
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'
                                and agtype in('HA')
                                        group by branch,aracde)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join yxbb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.get_yb_zgmwprl(datestart decimal(8,0),dateend decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                zgmplrl decimal(6,0),
                group char(1)
        )
        RETURN
                with mytable(branch,agntnum,bf) as(
                select branch,agntnum,sum(acctamt)
                        from v.ybnew
                                where trandate between datestart and dateend
                                and series = sys
                                group by branch,agntnum
                                        having sum(acctamt) >=10000)
                select a.branch,a.name,count(agntnum),a.group from administrator.hn_branch a left join mytable b
                        on a.branch = b.branch where a.branch <> 'D'
                                group by a.branch,a.name,a.group@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
CREATE FUNCTION f.get_yj_xq(monStart decimal(8,0),monEnd decimal(8,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(15),
                bb decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch),
                bb as
                (select agntbr as branch,agntara as aracde,sum(acctamt)bb 
                        from administrator.hn_xuqiacct 
                            where trandate between monStart and monEnd
                            and agtype in('HA')
                            group by agntbr,agntara)
                select a.branch,a.name,a.aracde,a.shortname,b.bb,a.group from branch a left join bb b 
                        on a.branch = b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
CREATE FUNCTION f.get_yb_zjz(monStart decimal(8,0),monEnd decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = sys) 
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
CREATE FUNCTION f.get_yb_qjjz(monStart decimal(8,0),monEnd decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from hnii29.hn_ybyj
                                                        where trandate between monStart and monEnd
                                                        and series = sys
                                                        and ((FREQ = '12' and sort = 'y') or (sort = 'g' and freq <> 'S')) )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
CREATE FUNCTION f.get_yb_gjz(monStart decimal(8,0),monEnd decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                jzbf decimal(20,2),
                group char(1)
        )
        RETURN
                with branch as(
                select branch,name,group
                        from administrator.hn_branch where branch <> 'D'),
                yxjz as
                (select branch,sum(xdgx) as jz from administrator.hn_xdgx 
                        where chdrnum in(select distinct chdrnum 
                                                from v.ybnew
                                                        where trandate between monStart and monEnd
                                                        and series = sys and isdgx = 'Y' )
                        and trandate between monStart and monEnd
                                group by branch)
                select a.branch,a.name,b.jz,a.group from branch a left join yxjz b on a.branch = b.branch@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.get_yx_bbrl(monStart decimal(8,0),monEnd decimal(8,0),rule decimal(6,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(20),
                rl decimal(6,0),
                bf decimal(15,0),
                js decimal(6,0),
                group char(1)
        )
        RETURN
                with chdrinfo as(
                select branch,aracde,agntnum,chdrnum,sum(acctamt_std) as bf 
                        from administrator.hn_acctinfo  
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  
                                and agtype in ('TA','SA','SM','SD','AS','SS','UM','AD','SE','HD','TS')
                                        group by branch,aracde,chdrnum,agntnum
                                                having sum(acctamt_std) >= rule),
                kpi as(
                select branch,aracde,count(distinct agntnum) as rl,count(chdrnum) as js,sum(bf) as bf
                        from chdrinfo 
                                group by branch,aracde),
                branchList as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch)
                select a.branch,a.name,a.aracde,a.shortname,b.rl,b.bf,b.js,a.group 
                        from branchList a left join kpi b on a.branch=b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.get_xq_bbrl(monStart decimal(8,0),monEnd decimal(8,0),rule decimal(6,0))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                aracde char(3),
                shortname varchar(20),
                rl decimal(6,0),
                bf decimal(15,0),
                js decimal(6,0),
                group char(1)
        )
        RETURN
                with chdrinfo as(
                select branch,aracde,agntnum,chdrnum,sum(acctamt_std) as bf 
                        from administrator.hn_acctinfo  
                                where trandate between monStart and monEnd and batctrcde<>'TGJC'  
                                and agtype in ('RC')
                                        group by branch,aracde,chdrnum,agntnum
                                                having sum(acctamt_std) >= rule),
                kpi as(
                select branch,aracde,count(distinct agntnum) as rl,count(chdrnum) as js,sum(bf) as bf
                        from chdrinfo 
                                group by branch,aracde),
                branchList as(
                select b.branch,b.name,a.aracde,a.shortname,b.group 
                        from administrator.hn_aracde a,administrator.hn_branch b 
                                where a.branch=b.branch)
                select a.branch,a.name,a.aracde,a.shortname,b.rl,b.bf,b.js,a.group 
                        from branchList a left join kpi b on a.branch=b.branch and a.aracde=b.aracde@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
CREATE FUNCTION f.getstate( state char(2) )
        RETURNS VARCHAR(12)
        NO EXTERNAL ACTION

F1: BEGIN ATOMIC
        declare state_1 char(2);
        set state_1 = state;
        RETURN
        values(case
                when state = 'CF' then ''
                when state = 'IF' then ''
                when state = 'MU' then ''
                when state = 'PT' then ''
                when state = 'SO' then ''
                when state = 'PS' then ''
                when state = 'DC' then ''
                when state = 'LA' then ''
                when state = 'PC' then ''
                when state = 'PU' then ''
                when state = 'SD' then ''
                when state = 'DH' then ''
                when state = 'MA' then ''
                when state = 'PO' then ''
                when state = 'RD' then ''
                when state = 'WD' then ''
                when state = 'EX' then ''
                when state = 'MR' then ''
                when state = 'SU' then ''
                when state = 'YX' then ''
                when state = 'ZT' then ''
                else state_1
        end);
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
CREATE FUNCTION f.getbankname( bank char(2) )
        RETURNS VARCHAR(12)
        NO EXTERNAL ACTION

F1: BEGIN ATOMIC
        RETURN
        values(case
                when bank = '01' then ''
                when bank = '02' then ''
                when bank = '03' then ''
                when bank = '04' then ''
                when bank = '05' then ''
                when bank = '06' then ''
                when bank = '09' then ''
                when bank = '10' then ''
                when bank = '11' then ''
                when bank = '14' then ''
                when bank = '16' then ''
                when bank = '17' then ''
                when bank = '18' then ''
                when bank = '28' then ''
                when bank = '15' then ''
                else ''
        end);
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
CREATE FUNCTION f.date_int(mydate date )
        RETURNS integer
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN
        values(year(mydate)*10000+month(mydate)*100+day(mydate));
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
CREATE FUNCTION f.getcnttypename( cnttype CHAR(3) )
        RETURNS CHAR(50)
        NO EXTERNAL ACTION
F1: BEGIN ATOMIC
        RETURN SELECT trim(value(longdesc,''))
  FROM administrator.hn_cnttype where descitem=cnttype;
END
@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
CREATE FUNCTION f.get_yb_dgx_zs(monStart decimal(8,0),monEnd decimal(8,0),sys varchar(3))
        RETURNS TABLE(
                branch char(2),
                name varchar(12),
                bf decimal(20,2),
                group char(1)
        )
        RETURN
        with mytable(branch,bf) as
        (select branch,sum(case when freq = 'D' then acctamt_std else acctamt end) bf
                from v.ybnew
                        where trandate between monStart and monEnd
                        and series = sys and isdgx='Y'
                                group by branch)
        select a.branch,a.name,value(b.bf,0),a.group
                from administrator.hn_branch a left join mytable b
                        on a.branch=b.branch
                                where a.branch <> 'D'@                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

  159 record(s) selected.

